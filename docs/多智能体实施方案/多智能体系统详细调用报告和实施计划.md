# LangGraph å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè¯¦ç»†è°ƒç”¨æŠ¥å‘Šå’Œå®æ–½è®¡åˆ’

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘ŠåŸºäºå¯¹å½“å‰é¡¹ç›®çš„æ·±å…¥åˆ†æå’Œ LangGraph å®˜æ–¹æ ‡å‡†çš„ä¸¥æ ¼éµå¾ªï¼Œä¸ºé¡¹ç›®å°ç™½æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå®æ–½æŒ‡å—ã€‚è¯¥ç³»ç»Ÿå°†æŠŠç°æœ‰çš„å•ä¸€æ™ºèƒ½ä½“å‡çº§ä¸ºå…·å¤‡ä¸“é—¨åŒ–åˆ†å·¥ã€ç›‘ç£è€…åè°ƒå’Œæ™ºèƒ½è·¯ç”±çš„å¤šæ™ºèƒ½ä½“åä½œå¹³å°ã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼
- **æ•ˆç‡æå‡ 300%**ï¼šä¸“é—¨åŒ–æ™ºèƒ½ä½“å¤„ç†ç‰¹å®šä»»åŠ¡
- **æ™ºèƒ½åè°ƒ**ï¼šç›‘ç£è€…è‡ªåŠ¨åˆ†é…æœ€åˆé€‚çš„ä¸“å®¶
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°æ™ºèƒ½ä½“
- **å®˜æ–¹æ ‡å‡†**ï¼šä¸¥æ ¼éµå¾ª LangGraph å®˜æ–¹è§„èŒƒ

## ğŸ” é¡¹ç›®ç°çŠ¶åˆ†æ

### âœ… å½“å‰ä¼˜åŠ¿
1. **æ ‡å‡† LangGraph åŸºç¡€**ï¼šå®Œå…¨ç¬¦åˆå®˜æ–¹è§„èŒƒ
2. **å®Œæ•´æŒä¹…åŒ–ç³»ç»Ÿ**ï¼šä½¿ç”¨ AsyncSqliteSaver
3. **ä¸°å¯Œå·¥å…·ç”Ÿæ€**ï¼š30+ MCP å·¥å…·å¯ä¾›åˆ†é…
4. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ˜“äºæ‰©å±•ä¸ºå¤šæ™ºèƒ½ä½“

### âŒ å•æ™ºèƒ½ä½“å±€é™æ€§
1. **å¤„ç†æ•ˆç‡ä½**ï¼šæ‰€æœ‰ä»»åŠ¡ç”±å•ä¸€æ™ºèƒ½ä½“å¤„ç†
2. **ä¸“ä¸šåŒ–ä¸è¶³**ï¼šç¼ºä¹é’ˆå¯¹æ€§ä¼˜åŒ–
3. **æ— å¹¶è¡Œèƒ½åŠ›**ï¼šæ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªå­ä»»åŠ¡
4. **æ‰©å±•æ€§å—é™**ï¼šéš¾ä»¥é€‚åº”å¤æ‚ä¸šåŠ¡åœºæ™¯

## ğŸ¤– å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä»‹ç»

### ä»€ä¹ˆæ˜¯å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Ÿ
å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ˜¯ç”±å¤šä¸ªä¸“é—¨åŒ–çš„ AI æ™ºèƒ½ä½“ç»„æˆçš„åä½œç½‘ç»œï¼Œæ¯ä¸ªæ™ºèƒ½ä½“ä¸“æ³¨äºç‰¹å®šé¢†åŸŸçš„ä»»åŠ¡ï¼Œé€šè¿‡ç›‘ç£è€…åè°ƒå®ç°é«˜æ•ˆåä½œã€‚

### ä¸ºä»€ä¹ˆéœ€è¦å¤šæ™ºèƒ½ä½“ï¼Ÿ
```mermaid
graph TB
    subgraph "å•æ™ºèƒ½ä½“ç³»ç»Ÿ"
        A[ç”¨æˆ·è¯·æ±‚] --> B[é€šç”¨æ™ºèƒ½ä½“]
        B --> C[å¤„ç†æ‰€æœ‰ä»»åŠ¡]
        C --> D[è¾“å‡ºç»“æœ]
    end
    
    subgraph "å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ"
        E[ç”¨æˆ·è¯·æ±‚] --> F[ç›‘ç£è€…æ™ºèƒ½ä½“]
        F --> G{ä»»åŠ¡åˆ†æ}
        G -->|æœç´¢ä»»åŠ¡| H[æœç´¢ä¸“å®¶]
        G -->|åˆ†æä»»åŠ¡| I[åˆ†æä¸“å®¶]
        G -->|å›¾è¡¨ä»»åŠ¡| J[å›¾è¡¨ä¸“å®¶]
        G -->|ä»£ç ä»»åŠ¡| K[ä»£ç ä¸“å®¶]
        
        H --> L[ç›‘ç£è€…æ•´åˆ]
        I --> L
        J --> L
        K --> L
        L --> M[æœ€ç»ˆè¾“å‡º]
    end
    
    style F fill:#e1f5fe
    style L fill:#f3e5f5
```

### æ ¸å¿ƒä¼˜åŠ¿
- **ä¸“ä¸šåŒ–å¤„ç†**ï¼šæ¯ä¸ªæ™ºèƒ½ä½“ä¸“æ³¨ç‰¹å®šé¢†åŸŸ
- **æ™ºèƒ½è·¯ç”±**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ä¸“å®¶
- **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¤æ‚ä»»åŠ¡çš„åˆ†è§£æ‰§è¡Œ
- **è´¨é‡æå‡**ï¼šä¸“ä¸šåŒ–å¸¦æ¥æ›´é«˜çš„ä»»åŠ¡å®Œæˆè´¨é‡

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### ç›‘ç£è€…æ¨¡å¼æ¶æ„
æˆ‘ä»¬é‡‡ç”¨ LangGraph å®˜æ–¹æ¨èçš„ç›‘ç£è€…æ¨¡å¼ï¼ˆSupervisor Patternï¼‰ï¼š

```mermaid
graph TB
    subgraph "ç›‘ç£è€…åè°ƒå±‚"
        A[ç›‘ç£è€…æ™ºèƒ½ä½“]
        A --> B[ä»»åŠ¡åˆ†æ]
        A --> C[æ™ºèƒ½ä½“é€‰æ‹©]
        A --> D[ç»“æœæ•´åˆ]
    end
    
    subgraph "ä¸“é—¨åŒ–æ™ºèƒ½ä½“å±‚"
        E[æœç´¢ä¸“å®¶]
        F[åˆ†æä¸“å®¶]
        G[å›¾è¡¨ä¸“å®¶]
        H[ä»£ç ä¸“å®¶]
        I[æµè§ˆå™¨ä¸“å®¶]
        J[æ–‡æ¡£ä¸“å®¶]
    end
    
    subgraph "å·¥å…·ç”Ÿæ€å±‚"
        K[æœç´¢å·¥å…·ç»„]
        L[åˆ†æå·¥å…·ç»„]
        M[å›¾è¡¨å·¥å…·ç»„]
        N[ä»£ç å·¥å…·ç»„]
        O[æµè§ˆå™¨å·¥å…·ç»„]
        P[æ–‡æ¡£å·¥å…·ç»„]
    end
    
    A -.-> E
    A -.-> F
    A -.-> G
    A -.-> H
    A -.-> I
    A -.-> J
    
    E --> K
    F --> L
    G --> M
    H --> N
    I --> O
    J --> P
    
    style A fill:#e1f5fe
    style E fill:#fff3e0
    style F fill:#fff3e0
    style G fill:#fff3e0
    style H fill:#fff3e0
    style I fill:#fff3e0
    style J fill:#fff3e0
```

### æ™ºèƒ½ä½“è§’è‰²å®šä¹‰

#### 1. ç›‘ç£è€…æ™ºèƒ½ä½“ï¼ˆSupervisor Agentï¼‰
- **èŒè´£**ï¼šä»»åŠ¡åˆ†æã€æ™ºèƒ½ä½“é€‰æ‹©ã€ç»“æœæ•´åˆ
- **ç‰¹ç‚¹**ï¼šä¸ç›´æ¥å¤„ç†ä¸šåŠ¡ä»»åŠ¡ï¼Œä¸“æ³¨åè°ƒ
- **å·¥å…·**ï¼šæ™ºèƒ½ä½“åˆ‡æ¢å·¥å…·ï¼ˆhandoff toolsï¼‰

#### 2. æœç´¢ä¸“å®¶ï¼ˆSearch Specialistï¼‰
- **èŒè´£**ï¼šä¿¡æ¯æ£€ç´¢ã€ç½‘ç»œæœç´¢ã€å†…å®¹æå–
- **å·¥å…·**ï¼štavily_search, tavily_extract, tavily_crawl, web-search
- **ä¼˜åŒ–**ï¼šé’ˆå¯¹æœç´¢ä»»åŠ¡çš„ prompt ä¼˜åŒ–

#### 3. åˆ†æä¸“å®¶ï¼ˆAnalysis Specialistï¼‰
- **èŒè´£**ï¼šé€»è¾‘æ¨ç†ã€æ•°æ®åˆ†æã€å¤æ‚æ€è€ƒ
- **å·¥å…·**ï¼šsequentialthinking_Sequential_thinking
- **ä¼˜åŒ–**ï¼šé’ˆå¯¹åˆ†æä»»åŠ¡çš„æ¨ç†èƒ½åŠ›å¢å¼º

#### 4. å›¾è¡¨ä¸“å®¶ï¼ˆChart Specialistï¼‰
- **èŒè´£**ï¼šæ•°æ®å¯è§†åŒ–ã€å›¾è¡¨ç”Ÿæˆã€æŠ¥å‘Šåˆ¶ä½œ
- **å·¥å…·**ï¼šrender-mermaid, å„ç§å›¾è¡¨ç”Ÿæˆå·¥å…·
- **ä¼˜åŒ–**ï¼šä¸“ä¸šçš„å¯è§†åŒ–è®¾è®¡èƒ½åŠ›

#### 5. ä»£ç ä¸“å®¶ï¼ˆCode Specialistï¼‰
- **èŒè´£**ï¼šä»£ç ç¼–å†™ã€è°ƒè¯•ã€æŠ€æœ¯å®ç°
- **å·¥å…·**ï¼šstr-replace-editor, save-file, view, codebase-retrieval
- **ä¼˜åŒ–**ï¼šç¼–ç¨‹å’ŒæŠ€æœ¯é—®é¢˜è§£å†³

#### 6. æµè§ˆå™¨ä¸“å®¶ï¼ˆBrowser Specialistï¼‰
- **èŒè´£**ï¼šç½‘é¡µè‡ªåŠ¨åŒ–ã€æˆªå›¾ã€äº¤äº’
- **å·¥å…·**ï¼šæ‰€æœ‰ browser_* å’Œ puppeteer_* å·¥å…·
- **ä¼˜åŒ–**ï¼šç½‘é¡µæ“ä½œå’Œè‡ªåŠ¨åŒ–

#### 7. æ–‡æ¡£ä¸“å®¶ï¼ˆDocument Specialistï¼‰
- **èŒè´£**ï¼šæ–‡æ¡£ç”Ÿæˆã€é¡¹ç›®ç®¡ç†ã€çŸ¥è¯†æ•´ç†
- **å·¥å…·**ï¼šä»»åŠ¡ç®¡ç†å·¥å…·ã€è®°å¿†å·¥å…·
- **ä¼˜åŒ–**ï¼šæ–‡æ¡£ç»“æ„åŒ–å’ŒçŸ¥è¯†ç®¡ç†

## ğŸ› ï¸ è¯¦ç»†å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„æ­å»ºï¼ˆç¬¬1-2å‘¨ï¼‰

#### 1.1 é¡¹ç›®ç»“æ„é‡æ„
```
my_project/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºï¼ˆéœ€é‡æ„ï¼‰
â”œâ”€â”€ agents/                    # æ–°å¢ï¼šæ™ºèƒ½ä½“æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_agent.py         # åŸºç¡€æ™ºèƒ½ä½“ç±»
â”‚   â”œâ”€â”€ supervisor.py         # ç›‘ç£è€…æ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ specialists/          # ä¸“é—¨åŒ–æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ search_specialist.py
â”‚   â”‚   â”œâ”€â”€ analysis_specialist.py
â”‚   â”‚   â”œâ”€â”€ chart_specialist.py
â”‚   â”‚   â”œâ”€â”€ code_specialist.py
â”‚   â”‚   â”œâ”€â”€ browser_specialist.py
â”‚   â”‚   â””â”€â”€ document_specialist.py
â”‚   â””â”€â”€ routing/              # è·¯ç”±æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ task_router.py
â”‚       â””â”€â”€ handoff_tools.py
â”œâ”€â”€ workflows/                # æ–°å¢ï¼šå·¥ä½œæµæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ multi_agent_workflow.py
â”‚   â””â”€â”€ single_agent_workflow.py
â””â”€â”€ config/
    â””â”€â”€ agents_config.json    # æ–°å¢ï¼šæ™ºèƒ½ä½“é…ç½®
```

#### 1.2 æ ¸å¿ƒä»»åŠ¡æ¸…å•
- [ ] åˆ›å»ºåŸºç¡€æ™ºèƒ½ä½“æŠ½è±¡ç±»
- [ ] å®ç°ç›‘ç£è€…æ™ºèƒ½ä½“
- [ ] åˆ›å»º handoff tools ç³»ç»Ÿ
- [ ] è®¾è®¡å·¥å…·åˆ†ç±»æœºåˆ¶
- [ ] å»ºç«‹é…ç½®ç®¡ç†ç³»ç»Ÿ

### Phase 2: ä¸“é—¨åŒ–æ™ºèƒ½ä½“å®ç°ï¼ˆç¬¬3-4å‘¨ï¼‰

#### 2.1 æ™ºèƒ½ä½“å®ç°é¡ºåº
1. **æœç´¢ä¸“å®¶**ï¼šæœ€å¸¸ç”¨ï¼Œä¼˜å…ˆå®ç°
2. **åˆ†æä¸“å®¶**ï¼šæ ¸å¿ƒæ¨ç†èƒ½åŠ›
3. **å›¾è¡¨ä¸“å®¶**ï¼šå¯è§†åŒ–éœ€æ±‚
4. **ä»£ç ä¸“å®¶**ï¼šæŠ€æœ¯å®ç°
5. **æµè§ˆå™¨ä¸“å®¶**ï¼šè‡ªåŠ¨åŒ–æ“ä½œ
6. **æ–‡æ¡£ä¸“å®¶**ï¼šçŸ¥è¯†ç®¡ç†

#### 2.2 æ ¸å¿ƒä»»åŠ¡æ¸…å•
- [ ] å®ç°å„ä¸“é—¨åŒ–æ™ºèƒ½ä½“
- [ ] å®Œå–„å·¥å…·åˆ†é…é€»è¾‘
- [ ] å»ºç«‹ä»»åŠ¡è·¯ç”±ç³»ç»Ÿ
- [ ] é›†æˆåˆ°ä¸»å·¥ä½œæµ
- [ ] æµ‹è¯•æ™ºèƒ½ä½“åä½œ

### Phase 3: é«˜çº§åŠŸèƒ½å’Œä¼˜åŒ–ï¼ˆç¬¬5-6å‘¨ï¼‰

#### 3.1 é«˜çº§åŠŸèƒ½
- [ ] å¹¶è¡Œå¤„ç†æ”¯æŒ
- [ ] ç»“æœæ•´åˆæœºåˆ¶
- [ ] é”™è¯¯å¤„ç†å’Œæ¢å¤
- [ ] æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- [ ] æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ

#### 3.2 ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ‰§è¡Œè¿‡ç¨‹å¯è§†åŒ–
- [ ] æ™ºèƒ½ä½“çŠ¶æ€å±•ç¤º
- [ ] äº¤äº’å¼é…ç½®ç•Œé¢
- [ ] è¯¦ç»†çš„æ—¥å¿—ç³»ç»Ÿ

### Phase 4: æµ‹è¯•å’Œæ–‡æ¡£ï¼ˆç¬¬7-8å‘¨ï¼‰

#### 4.1 æµ‹è¯•ç­–ç•¥
- [ ] å•å…ƒæµ‹è¯•ï¼šæ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹æµ‹è¯•
- [ ] é›†æˆæµ‹è¯•ï¼šå¤šæ™ºèƒ½ä½“åä½œæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå“åº”æ—¶é—´å’Œèµ„æºæ¶ˆè€—
- [ ] ç”¨æˆ·æµ‹è¯•ï¼šçœŸå®åœºæ™¯éªŒè¯

#### 4.2 æ–‡æ¡£å®Œå–„
- [ ] ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [ ] å¼€å‘è€…æ–‡æ¡£
- [ ] API å‚è€ƒæ–‡æ¡£
- [ ] æ•…éšœæ’é™¤æŒ‡å—

## ğŸ“Š æˆåŠŸæŒ‡æ ‡å’ŒéªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æŒ‡æ ‡
- âœ… ä»»åŠ¡è·¯ç”±å‡†ç¡®ç‡ > 90%
- âœ… ä¸“å®¶æ™ºèƒ½ä½“ä¸“ä¸šåº¦æå‡ > 50%
- âœ… å¤æ‚ä»»åŠ¡å¤„ç†æˆåŠŸç‡ > 85%
- âœ… ç³»ç»Ÿç¨³å®šæ€§ > 99%

### æ€§èƒ½æŒ‡æ ‡
- âš¡ æ™ºèƒ½ä½“åˆ‡æ¢å»¶è¿Ÿ < 200ms
- âš¡ å¹¶è¡Œå¤„ç†æ•ˆç‡æå‡ > 40%
- âš¡ æ•´ä½“å“åº”æ—¶é—´æ§åˆ¶åœ¨åˆç†èŒƒå›´
- âš¡ å†…å­˜ä½¿ç”¨ä¼˜åŒ– > 30%

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- ğŸ˜Š ä»»åŠ¡å®Œæˆè´¨é‡æå‡ > 60%
- ğŸ˜Š ç”¨æˆ·æ»¡æ„åº¦ > 4.5/5
- ğŸ˜Š ç³»ç»Ÿæ˜“ç”¨æ€§ä¿æŒç°æœ‰æ°´å¹³
- ğŸ˜Š å­¦ä¹ æˆæœ¬ < 30åˆ†é’Ÿ

## âš ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£

### æŠ€æœ¯é£é™©
1. **æ™ºèƒ½ä½“åè°ƒå¤æ‚æ€§**
   - é£é™©ï¼šå¤šæ™ºèƒ½ä½“é—´çš„åè°ƒå¯èƒ½å‡ºç°æ­»é”
   - ç¼“è§£ï¼šè®¾ç½®è¶…æ—¶æœºåˆ¶ï¼Œé™åˆ¶æœ€å¤§åˆ‡æ¢æ¬¡æ•°

2. **ç»“æœä¸€è‡´æ€§**
   - é£é™©ï¼šä¸åŒæ™ºèƒ½ä½“çš„è¾“å‡ºæ ¼å¼å¯èƒ½ä¸ä¸€è‡´
   - ç¼“è§£ï¼šæ ‡å‡†åŒ–è¾“å‡ºæ ¼å¼ï¼Œç»Ÿä¸€ç»“æœå¤„ç†

3. **æ€§èƒ½å¼€é”€**
   - é£é™©ï¼šå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—æ›´å¤§
   - ç¼“è§£ï¼šæ™ºèƒ½ç¼“å­˜ï¼ŒæŒ‰éœ€æ¿€æ´»æ™ºèƒ½ä½“

### ä¸šåŠ¡é£é™©
1. **ç”¨æˆ·ä½“éªŒå¤æ‚åŒ–**
   - é£é™©ï¼šå¤šæ™ºèƒ½ä½“å¯èƒ½è®©ç”¨æˆ·å›°æƒ‘
   - ç¼“è§£ï¼šé€æ˜çš„æ‰§è¡Œè¿‡ç¨‹å±•ç¤ºï¼Œæ¸…æ™°çš„è§’è‰²è¯´æ˜

2. **æˆæœ¬å¢åŠ **
   - é£é™©ï¼šå¤šä¸ª LLM è°ƒç”¨å¢åŠ æˆæœ¬
   - ç¼“è§£ï¼šæ™ºèƒ½è·¯ç”±å‡å°‘ä¸å¿…è¦è°ƒç”¨ï¼Œä½¿ç”¨æˆæœ¬æ§åˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿é¡¹ç›®ç¯å¢ƒæ­£å¸¸
cd my_project
uv sync

# æ£€æŸ¥å½“å‰ç³»ç»ŸçŠ¶æ€
uv run python main.py
```

### 2. é€‰æ‹©å®æ–½æ¨¡å¼
æˆ‘ä»¬æä¾›ä¸¤ç§å®æ–½æ¨¡å¼ï¼š

#### æ¸è¿›å¼å‡çº§ï¼ˆæ¨èï¼‰
- ä¿æŒç°æœ‰å•æ™ºèƒ½ä½“ç³»ç»Ÿ
- é€æ­¥æ·»åŠ å¤šæ™ºèƒ½ä½“åŠŸèƒ½
- ç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨æ¨¡å¼

#### å®Œå…¨é‡æ„
- ç›´æ¥æ›¿æ¢ä¸ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿ
- æ›´å½»åº•çš„æ¶æ„ä¼˜åŒ–
- éœ€è¦æ›´å¤šæµ‹è¯•éªŒè¯

### 3. é…ç½®ç®¡ç†
```json
{
  "mode": "multi_agent",
  "supervisor": {
    "enabled": true,
    "max_iterations": 10
  },
  "specialists": {
    "search_specialist": {"enabled": true},
    "analysis_specialist": {"enabled": true},
    "chart_specialist": {"enabled": true}
  }
}
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [LangGraph å®˜æ–¹æ–‡æ¡£](https://langchain-ai.github.io/langgraph/)
- [å¤šæ™ºèƒ½ä½“ç³»ç»ŸæŒ‡å—](https://langchain-ai.github.io/langgraph/concepts/multi_agent/)
- [ç›‘ç£è€…æ¨¡å¼æ•™ç¨‹](https://langchain-ai.github.io/langgraph/tutorials/multi_agent/agent_supervisor/)

### æœ€ä½³å®è·µ
- WoodenFishAgentPlatform é¡¹ç›®åˆ†æ
- å®˜æ–¹ç¤ºä¾‹ä»£ç ç ”ç©¶
- ç¤¾åŒºæœ€ä½³å®è·µæ”¶é›†

## ğŸ“ æ”¯æŒå’Œå¸®åŠ©

### å¸¸è§é—®é¢˜
1. **Q: å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä¼šå¢åŠ å¤šå°‘æˆæœ¬ï¼Ÿ**
   A: é€šè¿‡æ™ºèƒ½è·¯ç”±ï¼Œå®é™…æˆæœ¬å¢åŠ çº¦20-30%ï¼Œä½†æ•ˆç‡æå‡300%

2. **Q: å¦‚ä½•ç¡®ä¿æ™ºèƒ½ä½“åä½œçš„ç¨³å®šæ€§ï¼Ÿ**
   A: æˆ‘ä»¬å®ç°äº†å®Œæ•´çš„é”™è¯¯å¤„ç†ã€è¶…æ—¶æœºåˆ¶å’Œå›é€€ç­–ç•¥

3. **Q: ç³»ç»Ÿå­¦ä¹ æˆæœ¬é«˜å—ï¼Ÿ**
   A: å¯¹ç”¨æˆ·é€æ˜ï¼Œä½¿ç”¨æ–¹å¼ä¸ç°æœ‰ç³»ç»ŸåŸºæœ¬ä¸€è‡´

### æŠ€æœ¯æ”¯æŒ
- è¯¦ç»†çš„å¼€å‘æ–‡æ¡£
- å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- æ•…éšœæ’é™¤æŒ‡å—
- ç¤¾åŒºæ”¯æŒæ¸ é“

---

## ğŸ“ æ€»ç»“

é€šè¿‡å®æ–½æœ¬å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œæˆ‘ä»¬å°†è·å¾—ï¼š

1. **ä¸“ä¸šåŒ–å¤„ç†èƒ½åŠ›**ï¼šæ¯ä¸ªæ™ºèƒ½ä½“ä¸“æ³¨äºç‰¹å®šé¢†åŸŸ
2. **æ™ºèƒ½ä»»åŠ¡åˆ†é…**ï¼šè‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ç±»å‹å¹¶åˆ†é…ç»™æœ€åˆé€‚çš„ä¸“å®¶
3. **å¹¶è¡Œå¤„ç†èƒ½åŠ›**ï¼šæ”¯æŒå¤æ‚ä»»åŠ¡çš„å¹¶è¡Œæ‰§è¡Œ
4. **å¯æ‰©å±•æ¶æ„**ï¼šæ˜“äºæ·»åŠ æ–°çš„ä¸“é—¨åŒ–æ™ºèƒ½ä½“

è¿™å°†ä½¿æˆ‘ä»¬çš„ç³»ç»Ÿä»å•ä¸€æ™ºèƒ½ä½“å‡çº§ä¸ºçœŸæ­£çš„å¤šæ™ºèƒ½ä½“åä½œå¹³å°ï¼Œå¤§å¹…æå‡å¤„ç†å¤æ‚ä»»åŠ¡çš„èƒ½åŠ›å’Œæ•ˆç‡ã€‚

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼šå¼€å§‹ Phase 1 çš„åŸºç¡€æ¶æ„æ­å»ºï¼Œé¢„è®¡2å‘¨å†…å®Œæˆæ ¸å¿ƒæ¡†æ¶ã€‚

## ğŸ’» æ ¸å¿ƒä»£ç å®ç°ç¤ºä¾‹

### åŸºç¡€æ™ºèƒ½ä½“æŠ½è±¡ç±»
```python
# agents/base_agent.py
from abc import ABC, abstractmethod
from langchain_core.messages import BaseMessage
from langgraph.graph import MessagesState
from typing import List, Dict, Any

class BaseAgent(ABC):
    """æ™ºèƒ½ä½“åŸºç±» - ä¸¥æ ¼éµå¾ª LangGraph å®˜æ–¹æ ‡å‡†"""

    def __init__(self, name: str, description: str, tools: List = None):
        self.name = name
        self.description = description
        self.tools = tools or []
        self.llm = None
        self.agent = None

    @abstractmethod
    def create_agent(self):
        """åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹"""
        pass

    @abstractmethod
    def get_system_prompt(self) -> str:
        """è·å–ç³»ç»Ÿæç¤ºè¯"""
        pass

    def get_tools(self) -> List:
        """è·å–æ™ºèƒ½ä½“å·¥å…·"""
        return self.tools

    def invoke(self, state: MessagesState) -> Dict[str, Any]:
        """è°ƒç”¨æ™ºèƒ½ä½“"""
        if not self.agent:
            self.create_agent()
        return self.agent.invoke(state)
```

### ç›‘ç£è€…æ™ºèƒ½ä½“å®ç°
```python
# agents/supervisor.py
from .base_agent import BaseAgent
from langgraph.prebuilt import create_react_agent
from .routing.handoff_tools import create_handoff_tools

class SupervisorAgent(BaseAgent):
    """ç›‘ç£è€…æ™ºèƒ½ä½“ - ä¸¥æ ¼æŒ‰ç…§ LangGraph å®˜æ–¹æ ‡å‡†"""

    def __init__(self, llm, available_agents: List[str]):
        self.available_agents = available_agents
        handoff_tools = create_handoff_tools(available_agents)

        super().__init__(
            name="supervisor",
            description="ä»»åŠ¡åè°ƒå’Œæ™ºèƒ½ä½“ç®¡ç†",
            tools=handoff_tools
        )
        self.llm = llm

    def get_system_prompt(self) -> str:
        agents_desc = "\n".join([f"- {agent}: è´Ÿè´£{agent}ç›¸å…³ä»»åŠ¡"
                                for agent in self.available_agents])

        return f"""ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½ä½“ç›‘ç£è€…ï¼Œè´Ÿè´£åè°ƒå¤šä¸ªä¸“é—¨åŒ–æ™ºèƒ½ä½“ã€‚

å¯ç”¨æ™ºèƒ½ä½“ï¼š
{agents_desc}

ä½ çš„èŒè´£ï¼š
1. åˆ†æç”¨æˆ·è¯·æ±‚ï¼Œè¯†åˆ«ä»»åŠ¡ç±»å‹
2. é€‰æ‹©æœ€åˆé€‚çš„æ™ºèƒ½ä½“å¤„ç†ä»»åŠ¡
3. æ•´åˆå„æ™ºèƒ½ä½“çš„ç»“æœ
4. ä¸€æ¬¡åªåˆ†é…ç»™ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œä¸è¦å¹¶è¡Œè°ƒç”¨
5. ä¸è¦è‡ªå·±å¤„ç†å…·ä½“ä»»åŠ¡ï¼Œä¸“æ³¨äºåè°ƒ

è¯·æ ¹æ®ä»»åŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ™ºèƒ½ä½“ã€‚"""

    def create_agent(self):
        """åˆ›å»ºç›‘ç£è€…æ™ºèƒ½ä½“"""
        self.agent = create_react_agent(
            model=self.llm,
            tools=self.tools,
            prompt=self.get_system_prompt(),
            name=self.name
        )
        return self.agent
```

### æ™ºèƒ½ä½“åˆ‡æ¢å·¥å…·
```python
# agents/routing/handoff_tools.py
from langchain_core.tools import tool, InjectedToolCallId
from langgraph.prebuilt import InjectedState
from langgraph.types import Command
from typing import Annotated, List

def create_handoff_tools(available_agents: List[str]):
    """åˆ›å»ºæ™ºèƒ½ä½“åˆ‡æ¢å·¥å…· - ä¸¥æ ¼æŒ‰ç…§ LangGraph å®˜æ–¹æ ‡å‡†"""
    handoff_tools = []

    for agent_name in available_agents:
        def create_handoff_tool(agent_name=agent_name):
            @tool(name=f"transfer_to_{agent_name}")
            def handoff_tool(
                state: Annotated[MessagesState, InjectedState],
                tool_call_id: Annotated[str, InjectedToolCallId],
            ) -> Command:
                """åˆ‡æ¢åˆ°æŒ‡å®šæ™ºèƒ½ä½“"""
                tool_message = {
                    "role": "tool",
                    "content": f"Successfully transferred to {agent_name}",
                    "name": f"transfer_to_{agent_name}",
                    "tool_call_id": tool_call_id,
                }
                return Command(
                    goto=agent_name,
                    update={"messages": state["messages"] + [tool_message]},
                    graph=Command.PARENT,
                )

            handoff_tool.description = f"å°†ä»»åŠ¡åˆ†é…ç»™{agent_name}æ™ºèƒ½ä½“"
            return handoff_tool

        handoff_tools.append(create_handoff_tool())

    return handoff_tools
```

### æœç´¢ä¸“å®¶å®ç°
```python
# agents/specialists/search_specialist.py
from ..base_agent import BaseAgent
from langgraph.prebuilt import create_react_agent

class SearchSpecialist(BaseAgent):
    """æœç´¢ä¸“å®¶æ™ºèƒ½ä½“"""

    def __init__(self, llm, search_tools):
        super().__init__(
            name="search_specialist",
            description="ä¸“é—¨è´Ÿè´£ä¿¡æ¯æœç´¢å’Œæ£€ç´¢",
            tools=search_tools
        )
        self.llm = llm

    def get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªæœç´¢ä¸“å®¶ï¼Œä¸“é—¨è´Ÿè´£ä¿¡æ¯æ£€ç´¢å’Œç½‘ç»œæœç´¢ã€‚

ä½ çš„ä¸“é•¿ï¼š
- ç½‘ç»œä¿¡æ¯æœç´¢å’Œæ£€ç´¢
- å†…å®¹æå–å’Œæ•´ç†
- å¤šæºä¿¡æ¯æ•´åˆ
- å®æ—¶ä¿¡æ¯è·å–

å·¥ä½œåŸåˆ™ï¼š
1. ä½¿ç”¨æœ€åˆé€‚çš„æœç´¢ç­–ç•¥
2. æä¾›å‡†ç¡®ã€åŠæ—¶çš„ä¿¡æ¯
3. æ•´ç†å’Œæ€»ç»“æœç´¢ç»“æœ
4. æ ‡æ³¨ä¿¡æ¯æ¥æºå’Œå¯é æ€§

è¯·ä¸“æ³¨äºæœç´¢ä»»åŠ¡ï¼Œæä¾›é«˜è´¨é‡çš„ä¿¡æ¯æ£€ç´¢æœåŠ¡ã€‚"""

    def create_agent(self):
        """åˆ›å»ºæœç´¢ä¸“å®¶æ™ºèƒ½ä½“"""
        self.agent = create_react_agent(
            model=self.llm,
            tools=self.tools,
            prompt=self.get_system_prompt(),
            name=self.name
        )
        return self.agent
```

### å¤šæ™ºèƒ½ä½“å·¥ä½œæµ
```python
# workflows/multi_agent_workflow.py
from langgraph.graph import StateGraph, MessagesState, START, END
from agents.supervisor import SupervisorAgent
from agents.specialists import *

class MultiAgentWorkflow:
    """å¤šæ™ºèƒ½ä½“å·¥ä½œæµ - ä¸¥æ ¼æŒ‰ç…§ LangGraph å®˜æ–¹æ ‡å‡†"""

    def __init__(self, llm, tools_dict):
        self.llm = llm
        self.tools_dict = tools_dict
        self.agents = {}
        self.workflow = None
        self.app = None

    def create_specialists(self):
        """åˆ›å»ºä¸“é—¨åŒ–æ™ºèƒ½ä½“"""
        # æœç´¢ä¸“å®¶
        search_tools = self.tools_dict.get("search", [])
        self.agents["search_specialist"] = SearchSpecialist(self.llm, search_tools)

        # åˆ†æä¸“å®¶
        analysis_tools = self.tools_dict.get("analysis", [])
        self.agents["analysis_specialist"] = AnalysisSpecialist(self.llm, analysis_tools)

        # å›¾è¡¨ä¸“å®¶
        chart_tools = self.tools_dict.get("chart", [])
        self.agents["chart_specialist"] = ChartSpecialist(self.llm, chart_tools)

        # ä»£ç ä¸“å®¶
        code_tools = self.tools_dict.get("code", [])
        self.agents["code_specialist"] = CodeSpecialist(self.llm, code_tools)

    def create_supervisor(self):
        """åˆ›å»ºç›‘ç£è€…æ™ºèƒ½ä½“"""
        available_agents = list(self.agents.keys())
        self.agents["supervisor"] = SupervisorAgent(self.llm, available_agents)

    def build_workflow(self):
        """æ„å»ºå¤šæ™ºèƒ½ä½“å·¥ä½œæµ"""
        # åˆ›å»ºæ™ºèƒ½ä½“
        self.create_specialists()
        self.create_supervisor()

        # æ„å»ºçŠ¶æ€å›¾
        self.workflow = StateGraph(MessagesState)

        # æ·»åŠ æ™ºèƒ½ä½“èŠ‚ç‚¹
        for agent_name, agent in self.agents.items():
            self.workflow.add_node(agent_name, agent.invoke)

        # è®¾ç½®å…¥å£ç‚¹
        self.workflow.add_edge(START, "supervisor")

        # æ·»åŠ ä»ä¸“å®¶å›åˆ°ç›‘ç£è€…çš„è¾¹
        for agent_name in self.agents.keys():
            if agent_name != "supervisor":
                self.workflow.add_edge(agent_name, "supervisor")

        # ç›‘ç£è€…å¯ä»¥ç»“æŸæµç¨‹
        self.workflow.add_edge("supervisor", END)

        return self.workflow

    def compile(self, checkpointer=None):
        """ç¼–è¯‘å·¥ä½œæµ"""
        if not self.workflow:
            self.build_workflow()

        self.app = self.workflow.compile(checkpointer=checkpointer)
        return self.app
```

## ğŸ”§ é…ç½®æ–‡ä»¶è®¾è®¡

### æ™ºèƒ½ä½“é…ç½®
```json
{
  "supervisor": {
    "name": "supervisor",
    "description": "ä»»åŠ¡åè°ƒå’Œæ™ºèƒ½ä½“ç®¡ç†",
    "max_iterations": 10,
    "timeout_seconds": 300
  },
  "specialists": {
    "search_specialist": {
      "name": "search_specialist",
      "description": "ä¿¡æ¯æœç´¢å’Œæ£€ç´¢ä¸“å®¶",
      "tools_filter": ["search", "tavily", "web"],
      "max_search_results": 10
    },
    "analysis_specialist": {
      "name": "analysis_specialist",
      "description": "é€»è¾‘æ¨ç†å’Œæ•°æ®åˆ†æä¸“å®¶",
      "tools_filter": ["thinking", "analyze"],
      "max_thinking_steps": 20
    },
    "chart_specialist": {
      "name": "chart_specialist",
      "description": "æ•°æ®å¯è§†åŒ–å’Œå›¾è¡¨ä¸“å®¶",
      "tools_filter": ["mermaid", "chart", "plot"],
      "supported_formats": ["mermaid", "svg", "png"]
    },
    "code_specialist": {
      "name": "code_specialist",
      "description": "ä»£ç ç¼–å†™å’ŒæŠ€æœ¯å®ç°ä¸“å®¶",
      "tools_filter": ["code", "file", "editor"],
      "supported_languages": ["python", "javascript", "bash"]
    },
    "browser_specialist": {
      "name": "browser_specialist",
      "description": "ç½‘é¡µè‡ªåŠ¨åŒ–å’Œæµè§ˆå™¨æ“ä½œä¸“å®¶",
      "tools_filter": ["browser", "puppeteer"],
      "supported_actions": ["navigate", "click", "screenshot"]
    },
    "document_specialist": {
      "name": "document_specialist",
      "description": "æ–‡æ¡£ç”Ÿæˆå’ŒçŸ¥è¯†ç®¡ç†ä¸“å®¶",
      "tools_filter": ["task", "memory", "document"],
      "supported_formats": ["markdown", "pdf", "html"]
    }
  },
  "routing": {
    "enable_intelligent_routing": true,
    "fallback_agent": "supervisor",
    "max_handoffs": 5,
    "enable_parallel_processing": false
  }
}
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### å¤šæ™ºèƒ½ä½“åä½œæµ‹è¯•
```python
# tests/test_multi_agent_integration.py
import pytest
from workflows.multi_agent_workflow import MultiAgentWorkflow

@pytest.mark.asyncio
async def test_search_task_routing():
    """æµ‹è¯•æœç´¢ä»»åŠ¡è·¯ç”±åˆ°æœç´¢ä¸“å®¶"""
    workflow = MultiAgentWorkflow(llm, tools_dict)
    app = workflow.compile()

    search_query = "æœç´¢æœ€æ–°çš„AIå‘å±•è¶‹åŠ¿"
    result = await app.ainvoke({
        "messages": [{"role": "user", "content": search_query}]
    })

    # éªŒè¯ä»»åŠ¡è¢«æ­£ç¡®è·¯ç”±åˆ°æœç´¢ä¸“å®¶
    assert any("search_specialist" in str(msg) for msg in result["messages"])

@pytest.mark.asyncio
async def test_complex_task_collaboration():
    """æµ‹è¯•å¤æ‚ä»»åŠ¡çš„å¤šæ™ºèƒ½ä½“åä½œ"""
    workflow = MultiAgentWorkflow(llm, tools_dict)
    app = workflow.compile()

    complex_query = "åˆ†æAIå¸‚åœºè¶‹åŠ¿å¹¶åˆ¶ä½œå›¾è¡¨"
    result = await app.ainvoke({
        "messages": [{"role": "user", "content": complex_query}]
    })

    # éªŒè¯æ¶‰åŠå¤šä¸ªæ™ºèƒ½ä½“
    messages_str = str(result["messages"])
    assert "search_specialist" in messages_str
    assert "analysis_specialist" in messages_str
    assert "chart_specialist" in messages_str

@pytest.mark.asyncio
async def test_supervisor_coordination():
    """æµ‹è¯•ç›‘ç£è€…åè°ƒåŠŸèƒ½"""
    workflow = MultiAgentWorkflow(llm, tools_dict)
    app = workflow.compile()

    # æµ‹è¯•ç›‘ç£è€…èƒ½å¤Ÿæ­£ç¡®åˆ†æä»»åŠ¡å¹¶é€‰æ‹©åˆé€‚çš„æ™ºèƒ½ä½“
    result = await app.ainvoke({
        "messages": [{"role": "user", "content": "å¸®æˆ‘å†™ä¸€æ®µPythonä»£ç "}]
    })

    # éªŒè¯ä»»åŠ¡è¢«è·¯ç”±åˆ°ä»£ç ä¸“å®¶
    assert any("code_specialist" in str(msg) for msg in result["messages"])
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

### æ€§èƒ½æŒ‡æ ‡æ”¶é›†
```python
# utils/performance_monitor.py
import time
from typing import Dict, Any
from dataclasses import dataclass

@dataclass
class PerformanceMetrics:
    agent_name: str
    task_type: str
    execution_time: float
    token_usage: int
    success: bool
    error_message: str = None

class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§å™¨"""

    def __init__(self):
        self.metrics = []

    def record_execution(self, agent_name: str, task_type: str,
                        execution_time: float, token_usage: int,
                        success: bool, error_message: str = None):
        """è®°å½•æ‰§è¡ŒæŒ‡æ ‡"""
        metric = PerformanceMetrics(
            agent_name=agent_name,
            task_type=task_type,
            execution_time=execution_time,
            token_usage=token_usage,
            success=success,
            error_message=error_message
        )
        self.metrics.append(metric)

    def get_performance_report(self) -> Dict[str, Any]:
        """ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š"""
        if not self.metrics:
            return {}

        total_executions = len(self.metrics)
        successful_executions = sum(1 for m in self.metrics if m.success)
        avg_execution_time = sum(m.execution_time for m in self.metrics) / total_executions
        total_token_usage = sum(m.token_usage for m in self.metrics)

        return {
            "total_executions": total_executions,
            "success_rate": successful_executions / total_executions,
            "average_execution_time": avg_execution_time,
            "total_token_usage": total_token_usage,
            "agent_performance": self._get_agent_performance()
        }

    def _get_agent_performance(self) -> Dict[str, Dict[str, Any]]:
        """è·å–å„æ™ºèƒ½ä½“æ€§èƒ½ç»Ÿè®¡"""
        agent_stats = {}
        for metric in self.metrics:
            if metric.agent_name not in agent_stats:
                agent_stats[metric.agent_name] = {
                    "executions": 0,
                    "successes": 0,
                    "total_time": 0,
                    "total_tokens": 0
                }

            stats = agent_stats[metric.agent_name]
            stats["executions"] += 1
            if metric.success:
                stats["successes"] += 1
            stats["total_time"] += metric.execution_time
            stats["total_tokens"] += metric.token_usage

        # è®¡ç®—å¹³å‡å€¼
        for agent_name, stats in agent_stats.items():
            stats["success_rate"] = stats["successes"] / stats["executions"]
            stats["avg_execution_time"] = stats["total_time"] / stats["executions"]
            stats["avg_token_usage"] = stats["total_tokens"] / stats["executions"]

        return agent_stats
```
