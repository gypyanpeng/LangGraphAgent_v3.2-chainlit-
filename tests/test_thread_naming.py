#!/usr/bin/env python3
"""
æµ‹è¯•æ™ºèƒ½ä¼šè¯å‘½ååŠŸèƒ½
"""

import asyncio
import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from chainlit_app import generate_thread_name

async def test_thread_naming():
    """æµ‹è¯•æ™ºèƒ½ä¼šè¯å‘½ååŠŸèƒ½"""
    print("ğŸ§ª æµ‹è¯•æ™ºèƒ½ä¼šè¯å‘½ååŠŸèƒ½...")
    
    test_cases = [
        # æµ‹è¯•ç”¨ä¾‹: (è¾“å…¥æ¶ˆæ¯, æœŸæœ›çš„å‘½åæ¨¡å¼)
        ("ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•å†å²", "ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•å†å²"),
        ("ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ", "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ"),
        ("å¸®æˆ‘å†™ä¸€ä¸ªPythonç¨‹åº", "å¸®æˆ‘å†™ä¸€ä¸ªPythonç¨‹åº"),
        ("ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·", "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"),
        ("è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„æ¶ˆæ¯ï¼Œè¶…è¿‡äº†30ä¸ªå­—ç¬¦çš„é™åˆ¶ï¼Œåº”è¯¥ä¼šè¢«æˆªæ–­", "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„æ¶ˆæ¯ï¼Œè¶…è¿‡äº†30ä¸ªå­—ç¬¦çš„é™åˆ¶ï¼Œåº”è¯¥ä¼šè¢«æˆªæ–­"[:27] + "..."),
        ("hi", None),  # å¤ªçŸ­çš„æ¶ˆæ¯åº”è¯¥ä½¿ç”¨é»˜è®¤æ ¼å¼
        ("", None),    # ç©ºæ¶ˆæ¯åº”è¯¥ä½¿ç”¨é»˜è®¤æ ¼å¼
        ("   ", None), # åªæœ‰ç©ºæ ¼çš„æ¶ˆæ¯åº”è¯¥ä½¿ç”¨é»˜è®¤æ ¼å¼
        ("å¦‚ä½•å­¦ä¹ \n\næ·±åº¦å­¦ä¹ ï¼Ÿ", "å¦‚ä½•å­¦ä¹  æ·±åº¦å­¦ä¹ ï¼Ÿ"),  # æµ‹è¯•æ¢è¡Œç¬¦å¤„ç†
        ("ä½ èƒ½å¸®æˆ‘åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜å—ï¼Ÿ", "ä½ èƒ½å¸®æˆ‘åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜å—ï¼Ÿ"),  # æµ‹è¯•é—®å·ä¿ç•™
    ]
    
    print(f"\nğŸ“‹ æµ‹è¯• {len(test_cases)} ä¸ªç”¨ä¾‹:")
    
    for i, (input_msg, expected_pattern) in enumerate(test_cases, 1):
        try:
            result = await generate_thread_name(input_msg)
            
            print(f"\n{i}. è¾“å…¥: '{input_msg}'")
            print(f"   è¾“å‡º: '{result}'")
            
            # éªŒè¯ç»“æœ
            if expected_pattern is None:
                # å¯¹äºå¤ªçŸ­çš„æ¶ˆæ¯ï¼Œåº”è¯¥ä½¿ç”¨é»˜è®¤æ ¼å¼
                if "å¯¹è¯" in result and len(result) > 10:
                    print(f"   âœ… æ­£ç¡®ä½¿ç”¨é»˜è®¤æ ¼å¼")
                else:
                    print(f"   âŒ é»˜è®¤æ ¼å¼ä¸æ­£ç¡®")
            else:
                if expected_pattern in result or result == expected_pattern:
                    print(f"   âœ… å‘½åæ­£ç¡®")
                else:
                    print(f"   âŒ å‘½åä¸ç¬¦åˆé¢„æœŸ")
                    print(f"   æœŸæœ›: '{expected_pattern}'")
            
            # éªŒè¯é•¿åº¦é™åˆ¶
            if len(result) <= 35:  # å…è®¸ä¸€äº›é¢å¤–å­—ç¬¦
                print(f"   âœ… é•¿åº¦åˆé€‚ ({len(result)} å­—ç¬¦)")
            else:
                print(f"   âŒ é•¿åº¦è¿‡é•¿ ({len(result)} å­—ç¬¦)")
                
        except Exception as e:
            print(f"   âŒ æµ‹è¯•å¤±è´¥: {str(e)}")
    
    print(f"\nğŸ‰ æ™ºèƒ½å‘½ååŠŸèƒ½æµ‹è¯•å®Œæˆï¼")

if __name__ == "__main__":
    asyncio.run(test_thread_naming())
